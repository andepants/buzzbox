# Story 9.5: Memory Stats UI (Optional)

**Epic:** Epic 9 - Supermemory RAG Integration
**Story ID:** 9.5
**Priority:** P3 (Low - Optional Enhancement)
**Estimated Time:** 2 hours
**Dependencies:** Stories 9.1, 9.2, 9.4
**Status:** Draft

---

## ðŸ“– User Story

**As** Andrew (the creator),
**I want** to see how many conversations the AI has learned from,
**So that** I can understand the knowledge base growth and feel confident in the AI's learning progress.

---

## ðŸŽ¯ Acceptance Criteria

### Functional Requirements

1. **Profile Stats Section**
   - [ ] Add "AI Learning Stats" section in Profile view
   - [ ] Display total memories stored
   - [ ] Display pending sync count (from offline queue)
   - [ ] Display last sync timestamp
   - [ ] Show Supermemory enabled/disabled status

2. **Stats Display**
   - [ ] Format: "AI has learned from X conversations"
   - [ ] Show pending: "Y memories pending sync" (if > 0)
   - [ ] Show last sync: "Last synced: 2 minutes ago"
   - [ ] Green indicator when enabled, gray when disabled

3. **Real-Time Updates**
   - [ ] Stats update when new memory stored
   - [ ] Pending count updates when queue processed
   - [ ] Use `@Published` properties from SupermemoryService

### UI Requirements

4. **Visual Design**
   - [ ] Follow existing Profile section styling
   - [ ] Use SF Symbols: `brain` for AI stats
   - [ ] Use `clock` symbol for last sync
   - [ ] Use `exclamationmark.circle` for pending count
   - [ ] Match dark mode support

5. **Interaction**
   - [ ] Tap stats to manually trigger sync (if pending > 0)
   - [ ] Show loading indicator during manual sync
   - [ ] Toast message on successful sync
   - [ ] Read-only display (no editing)

### Code Quality Requirements

6. **Implementation Quality**
   - [ ] Extract stats into separate view component
   - [ ] Keep ProfileView readable (delegate to subview)
   - [ ] Add doc comments
   - [ ] Follow SwiftUI best practices

7. **Testing**
   - [ ] Stats display correctly for 0 memories
   - [ ] Stats update after sending reply
   - [ ] Pending count shows when offline
   - [ ] Manual sync button triggers queue processing

---

## ðŸ”§ Technical Implementation Notes

### SupermemoryService Updates

**File:** `Core/Services/SupermemoryService.swift`

Add published properties for UI binding:

```swift
// MARK: - Stats

@Published private(set) var totalMemoriesStored: Int = 0
@Published private(set) var lastSyncDate: Date?

/// Update stats after successful memory storage
private func updateStats() {
    totalMemoriesStored += 1
    lastSyncDate = Date()
}

/// Call this in addMemoryToAPI() after success
```

### New Stats View Component

**File:** `Core/Views/Profile/AILearningStatsView.swift`

```swift
import SwiftUI

/// Displays AI learning statistics in Profile
struct AILearningStatsView: View {
    @ObservedObject var supermemoryService = SupermemoryService.shared

    var body: some View {
        VStack(alignment: .leading, spacing: 12) {
            // Section Header
            HStack {
                Image(systemName: "brain")
                    .foregroundStyle(.blue)
                Text("AI Learning Stats")
                    .font(.headline)
                Spacer()
                StatusIndicator(enabled: supermemoryService.isEnabled)
            }

            // Total Memories
            if supermemoryService.isEnabled {
                StatRow(
                    icon: "checkmark.circle.fill",
                    label: "Learned from",
                    value: "\(supermemoryService.totalMemoriesStored) conversations"
                )

                // Pending Sync
                if supermemoryService.pendingMemoriesCount > 0 {
                    StatRow(
                        icon: "exclamationmark.circle.fill",
                        label: "Pending sync",
                        value: "\(supermemoryService.pendingMemoriesCount) memories",
                        color: .orange
                    )
                    .onTapGesture {
                        Task {
                            await supermemoryService.processPendingMemories()
                        }
                    }
                }

                // Last Sync
                if let lastSync = supermemoryService.lastSyncDate {
                    StatRow(
                        icon: "clock",
                        label: "Last synced",
                        value: lastSync.timeAgoDisplay()
                    )
                }
            } else {
                Text("Supermemory not configured")
                    .font(.subheadline)
                    .foregroundStyle(.secondary)
            }
        }
        .padding()
        .background(Color(.systemBackground))
        .cornerRadius(12)
        .shadow(radius: 2)
    }
}

/// Status indicator badge
struct StatusIndicator: View {
    let enabled: Bool

    var body: some View {
        Circle()
            .fill(enabled ? Color.green : Color.gray)
            .frame(width: 10, height: 10)
    }
}

/// Individual stat row
struct StatRow: View {
    let icon: String
    let label: String
    let value: String
    var color: Color = .primary

    var body: some View {
        HStack(spacing: 8) {
            Image(systemName: icon)
                .foregroundStyle(color)
                .frame(width: 20)
            Text(label + ":")
                .font(.subheadline)
                .foregroundStyle(.secondary)
            Text(value)
                .font(.subheadline)
                .fontWeight(.medium)
            Spacer()
        }
    }
}

// MARK: - Date Extension

extension Date {
    func timeAgoDisplay() -> String {
        let formatter = RelativeDateTimeFormatter()
        formatter.unitsStyle = .abbreviated
        return formatter.localizedString(for: self, relativeTo: Date())
    }
}
```

### Integration in ProfileView

**File:** `Core/Views/Profile/ProfileView.swift`

```swift
var body: some View {
    ScrollView {
        VStack(spacing: 20) {
            // ... existing profile content ...

            // AI Learning Stats (NEW)
            if AuthService.shared.isCreator {
                AILearningStatsView()
            }

            // ... rest of profile content ...
        }
        .padding()
    }
}
```

---

## ðŸŽ¨ UI Mockup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ðŸ§  AI Learning Stats           ðŸŸ¢  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ Learned from: 47 conversations   â”‚
â”‚ âš ï¸ Pending sync: 3 memories         â”‚ â† Tap to sync
â”‚ ðŸ• Last synced: 2 min ago           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**When Disabled:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ðŸ§  AI Learning Stats           âšªï¸  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Supermemory not configured          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”— Related Files

- **New:** `Core/Views/Profile/AILearningStatsView.swift` - Stats component
- **Modify:** `Core/Views/Profile/ProfileView.swift` - Add stats section
- **Modify:** `Core/Services/SupermemoryService.swift` - Add published stats
- **Reference:** Existing Profile sections for styling consistency

---

## ðŸ“‹ Definition of Done

- [ ] `AILearningStatsView.swift` created
- [ ] Integrated into `ProfileView` (creator only)
- [ ] SupermemoryService exposes stats via `@Published`
- [ ] All acceptance criteria met and tested
- [ ] Code compiles without warnings
- [ ] UI matches existing Profile style
- [ ] Dark mode support verified
- [ ] Manual sync button works
- [ ] Real-time updates working

---

## âš ï¸ Important Notes

1. **Creator Only:** Only show stats for Andrew (creator account)
2. **Optional Feature:** Can be skipped if time constrained
3. **No API Call:** Stats are local (totalMemoriesStored counter)
4. **Future Enhancement:** Could add Supermemory API stats endpoint
5. **Privacy:** No sensitive information displayed

---

## ðŸ” Testing Guidance

### Manual Testing Steps

**Test 1: Stats Display (Happy Path)**
1. Login as Andrew
2. Navigate to Profile
3. âœ… See "AI Learning Stats" section
4. âœ… Shows total memories count
5. âœ… Green indicator when enabled

**Test 2: Stats Update**
1. Note current count (e.g., 47)
2. Send manual reply to fan
3. Return to Profile
4. âœ… Count increased to 48
5. âœ… Last sync updated

**Test 3: Pending Sync Display**
1. Enable airplane mode
2. Send 3 replies
3. Go to Profile
4. âœ… Shows "Pending sync: 3 memories"
5. Tap pending row
6. Disable airplane mode
7. âœ… Pending count decreases as synced

**Test 4: Disabled State**
1. Remove Supermemory API key
2. Go to Profile
3. âœ… Gray indicator
4. âœ… Shows "Supermemory not configured"

**Test 5: Fan Account**
1. Logout
2. Login as fan
3. Go to Profile
4. âœ… No AI Learning Stats section (creator only)

---

## ðŸŽ“ Why This Feature Matters

### User Value

**For Andrew:**
- **Transparency:** See AI learning progress
- **Confidence:** Verify memories are being stored
- **Troubleshooting:** Spot sync issues easily
- **Motivation:** Watch knowledge base grow over time

**Example Use Case:**
> Andrew notices "Learned from 200 conversations" after 2 months. He thinks: "Wow, the AI has learned from 200 of my replies! No wonder the suggestions are getting better!"

### Technical Value

**For Development:**
- Easy debugging (see pending count)
- User can trigger manual sync
- Visibility into system health
- No need for external dashboard

### Future Enhancements

- Graph of memories over time
- Most common topics learned
- AI quality score based on memory count
- Export memory data

---

**Created by:** Sarah (PO Agent)
**Date:** 2025-10-26
**Priority:** Optional - Implement if time permits
